<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sofia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="finalbody.css">
  <style>
    /* Cartoony pastel theme */
body {
  position: relative;
  overflow-x: hidden;
  /* Remove or comment out the next three lines: */
  /* background: url("data:image/svg+xml;utf8,<svg width='40' height='40' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><path d='M16 29s-11-8.5-11-16A7 7 0 0 1 16 6a7 7 0 0 1 11 7c0 7.5-11 16-11 16z' fill='%23ffb6c1' stroke='%23b4a7ff' stroke-width='2'/></svg>");
  background-repeat: repeat;
  background-size: 64px 64px; */
  font-family: 'Comic Sans MS', 'Comic Sans', sans-serif;
  margin: 0;
  padding: 0;
}

header {
    background: #ffe0f7;
    border-bottom: 6px solid #b4a7ff;
    box-shadow: 0 4px 16px #b4a7ff33;
    text-align: center;
    padding: 40px 0 20px 0;
}

h1 {
    color: #ff69b4;
    font-size: 3em;
    text-shadow: 2px 2px 0 #fffbe7, 4px 4px 0 #b4a7ff;
    margin: 0;
}

h2 {
    color: #7b6cff;
    background: #fffbe7;
    border-radius: 16px;
    padding: 24px 32px;
    margin: 20px 0 10px 0;
    border: 2px solid #b4a7ff;
    box-shadow: 0 2px 8px #b4a7ff22;
}

p {
    color: #ff69b4;
    font-size: 1.2em;
    margin: 10px 0;
}

.timer-container h2 {
    color: #ffb347;
    font-size: 2.5em;
    background: #fffbe7;
    border-radius: 12px;
    display: inline-block;
    padding: 8px 24px;
    border: 2px solid #ffb347;
    box-shadow: 0 2px 8px #ffb34733;
}

main {
    background: #f7faff;
    border-radius: 24px;
    margin: 30px auto;
    max-width: 600px;
    padding: 30px 30px 20px 30px;
    box-shadow: 0 8px 32px #b4a7ff33;
    border: 4px solid #b4a7ff; /* Add this line for a pastel blue border */
    position: relative;
}

#love-interaction {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
    margin: 30px 0;
}

#user-input {
    border: 4px solid #ffb347;
    border-radius: 20px;
    padding: 12px 20px;
    font-size: 1.2em;
    font-family: 'Comic Sans MS', 'Comic Sans', sans-serif;
    background: #fffbe7;
    box-shadow: 0 4px 12px #ffb6c1;
    outline: none;
    transition: box-shadow 0.2s, border-color 0.2s;
}

#user-input:focus {
    box-shadow: 0 0 0 4px #ffe4ec;
    border-color: #7b6cff;
}

#love-btn {
    background: #b4a7ff;
    color: #fff;
    border: 3px solid #7b6cff;
    border-radius: 20px;
    padding: 12px 24px;
    font-size: 1.1em;
    font-family: 'Comic Sans MS', 'Comic Sans', sans-serif;
    cursor: pointer;
    box-shadow: 0 4px 12px #b4a7ff66;
    transition: background 0.2s, transform 0.1s, border-color 0.2s;
}

#love-btn:hover {
    background: #ffb347;
    color: #fff;
    border-color: #ff69b4;
    transform: scale(1.08) rotate(-2deg);
}

.bouncy-heart {
    display: inline-block;
    animation: bounce 0.7s infinite alternate cubic-bezier(.5,1.8,.5,1);
    filter: drop-shadow(0 2px 6px #ffb6c1);
}

@keyframes bounce {
    0%   { transform: translateY(0) scale(1);}
    60%  { transform: translateY(-20px) scale(1.2);}
    100% { transform: translateY(0) scale(1);}
}

footer {
    background: #ffe0f7;
    color: #b4a7ff;
    text-align: center;
    padding: 16px 0;
    border-top: 4px solid #b4a7ff;
    font-size: 1.1em;
    border-radius: 0 0 16px 16px;
    margin-top: 40px;
}

#fail-video {
    margin: 20px auto;
    display: none;
    max-width: 100vw;
    width: 400px;
    border-radius: 16px;
    box-shadow: 0 4px 16px #b4a7ff33;
    background: #fffbe7;
    outline: none;
    display: block;
}

#memory-game {
  display: grid;
  grid-template-columns: repeat(4, 60px);
  gap: 16px;
  justify-content: center;
  margin: 24px 0;
}
.memory-card {
  width: 60px;
  height: 60px;
  background: #fffbe7;
  border: 3px solid #b4a7ff;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2em;
  cursor: pointer;
  box-shadow: 0 2px 8px #b4a7ff33;
  transition: background 0.2s;
  user-select: none;
}
.memory-card.flipped {
  background: #ffb6c1;
}
.memory-card.matched {
  background: #b4a7ff;
  color: #fff;
  cursor: default;
}

/* Quiz and Love Note Buttons */
#quiz-options button,
#quiz-sofia-options button,
#memory-message button,
#pick-another {
  background: linear-gradient(135deg, #ffb6c1 60%, #b4a7ff 100%);
  border: 2px solid #b4a7ff;
  border-radius: 18px;
  color: #7b6cff;
  font-size: 1.1em;
  margin: 8px;
  padding: 12px 28px;
  font-family: 'Comic Sans MS', 'Comic Sans', sans-serif;
  cursor: pointer;
  box-shadow: 0 4px 12px #b4a7ff33;
  transition: background 0.2s, color 0.2s, transform 0.1s, border-color 0.2s;
}

#quiz-options button:hover,
#quiz-sofia-options button:hover,
#memory-message button:hover,
#pick-another:hover {
  background: linear-gradient(135deg, #b4a7ff 60%, #ffb6c1 100%);
  color: #fff;
  border-color: #ff69b4;
  transform: scale(1.07) rotate(-2deg);
}

#love-btn,
#save-message-btn,
#quiz-options button,
#quiz-sofia-options button,
#memory-message button,
#pick-another,
#save-doodle-btn,
#clear-doodle-btn {
  background: #ffb6c1; /* Pastel pink */
  border: 2px solid #b4a7ff;
  border-radius: 18px;
  color: #7b6cff;
  font-size: 1.1em;
  margin: 8px;
  padding: 12px 28px;
  font-family: 'Comic Sans MS', 'Comic Sans', sans-serif;
  cursor: pointer;
  box-shadow: 0 4px 12px #b4a7ff33;
  transition: background 0.2s, color 0.2s, transform 0.1s, border-color 0.2s;
}

#love-btn:hover,
#save-message-btn:hover,
#quiz-options button:hover,
#quiz-sofia-options button:hover,
#memory-message button:hover,
#pick-another:hover,
#save-doodle-btn:hover,
#clear-doodle-btn:hover {
  background: #b4a7ff; /* Pastel blue on hover */
  color: #fff;
  border-color: #ff69b4;
  transform: scale(1.07) rotate(-2deg);
}

/* Responsive adjustments for mobile */
@media (max-width: 600px) {
  main {
    padding: 10px 2vw 10px 2vw;
    max-width: 98vw;
  }
  h1 {
    font-size: 2em;
    padding: 30px 0;
  }
  h2 {
    font-size: 1.2em;
    padding: 14px 8px;
  }
  #memory-game {
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }
  .memory-card {
    width: 40px;
    height: 40px;
    font-size: 1.3em;
  }
  #fail-video {
    width: 98vw !important;
    max-width: 98vw;
  }
  #love-interaction {
    flex-direction: column;
    gap: 8px;
  }
  #user-input, #love-btn {
    width: 100%;
    box-sizing: border-box;
  }
  #quiz-options button {
    width: 100%;
    margin: 6px 0;
  }
}

#final-love-note-section {
  display: none;
  text-align: center;
  margin: 40px auto 20px auto;
}

#final-love-note {
  max-width: 90vw;
  width: 100%;
  margin: 0 auto;
  background: #fffbe7;
  border-radius: 20px;
  padding: 32px 24px;
  color: #7b6cff;
  font-size: 1.15em;
  box-shadow: 0 4px 24px #b4a7ff22;
  line-height: 1.7;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  z-index: 0;
  pointer-events: none;
  background: url("data:image/svg+xml;utf8,<svg width='40' height='40' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><path d='M16 29s-11-8.5-11-16A7 7 0 0 1 16 6a7 7 0 0 1 11 7c0 7.5-11 16-11 16z' fill='%23ffb6c1' stroke='%23b4a7ff' stroke-width='2'/></svg>");
  background-repeat: repeat;
  background-size: 64px 64px;
  animation: hearts-move 20s linear infinite;
}

@keyframes hearts-move {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 128px 128px;
  }
}

header, main, footer, #final-love-note-section, #fail-video {
  position: relative;
  z-index: 8;
}
  </style>
</head>
<body>
  <header>
  <h1>Happy Third Anniversary!</h1>
  <p>My heart laid out in code for you.</p>
  <div class="timer-container">
    <h2 id="countdown">30</h2>
  </div>
</header>

  <main>
    <section>
      <h2>Inside this website, is an interactive experience to commemorate our anniversarry.</h2>
      <p>Type, I love you, 3 times.</p>
    </section>
    <div id="love-message"></div>
    <div id="love-interaction">
      <input type="text" id="user-input" placeholder="Type 'I love you' here">
      <button id="love-btn">Submit</button>
    </div>
    <!-- Add this where you want the video to appear -->
<video id="fail-video" width="400" controls style="display:none;">
  <source src="WALANGPERSONALAN.MP4" type="video/mp4">
  Your browser does not support the video tag.
</video>

<!-- Memory Match Game Section -->
<section id="memory-section">
  <h2>Memory Match: Find the Pairs!</h2>
  <div id="memory-game"></div>
  <div id="memory-message"></div>
</section>

<!-- Quiz Game Section -->
<section id="quiz-section">
  <h2>Quiz: How Well Do You Know Me?</h2>
  <div id="quiz-question"></div>
  <div id="quiz-options"></div>
  <div id="quiz-result"></div>
</section>

<!-- Quiz About Sofia Section -->
<section id="quiz-sofia-section">
  <h2>Quiz: How Well Do I Know Sofia?</h2>
  <div id="quiz-sofia-question"></div>
  <div id="quiz-sofia-options"></div>
  <div id="quiz-sofia-result"></div>
</section>

<!-- Final Love Note Section -->
<section id="final-love-note-section" style="display:none; text-align:center;">
  <h2>My Love Letter to You</h2>
  <div id="final-love-note" style="max-width: 500px; margin: 0 auto; background: #fffbe7; border-radius: 16px; padding: 24px 20px; color: #7b6cff; font-size: 1.1em; box-shadow: 0 2px 8px #b4a7ff22;"></div>
</section>

<!-- Add this just above your <footer> -->
<section id="sofia-message-section" style="text-align:center; margin:40px auto 30px auto;">
  <h2>Leave a message for Loraine!</h2>
  <textarea id="sofia-message" rows="5" style="width:90%; max-width:500px; border-radius:16px; border:2px solid #b4a7ff; padding:16px; font-size:1.1em; font-family:'Comic Sans MS', 'Comic Sans', sans-serif; background:#fffbe7; color:#7b6cff; box-shadow:0 2px 8px #b4a7ff22;"></textarea>
  <br>
  <button id="save-message-btn" style="margin-top:16px; background:linear-gradient(135deg,#ffb6c1 60%,#b4a7ff 100%); color:#7b6cff; border:2px solid #b4a7ff; border-radius:18px; padding:12px 28px; font-size:1.1em; font-family:'Comic Sans MS', 'Comic Sans', sans-serif; cursor:pointer; box-shadow:0 4px 12px #b4a7ff33; transition:background 0.2s, color 0.2s, transform 0.1s, border-color 0.2s;">Save Message 💌</button>
  <div id="sofia-message-display" style="margin-top:24px; color:#ff69b4; font-size:1.15em;"></div>
</section>

<!-- Add this above your <footer> -->
<section id="drawing-section" style="text-align:center; margin:40px auto 30px auto;">
  <h2>Draw a doodle for Loraine!</h2>
  <canvas id="drawing-canvas" width="350" height="250" style="background:#fffbe7; border:2px solid #b4a7ff; border-radius:18px; box-shadow:0 2px 8px #b4a7ff22; cursor:crosshair;"></canvas>
  <br>
  <button id="save-doodle-btn" style="margin:12px 8px; background:linear-gradient(135deg,#ffb6c1 60%,#b4a7ff 100%); color:#7b6cff; border:2px solid #b4a7ff; border-radius:18px; padding:10px 24px; font-size:1.1em; font-family:'Comic Sans MS', 'Comic Sans', sans-serif; cursor:pointer;">Save Doodle</button>
  <button id="clear-doodle-btn" style="margin:12px 8px; background:linear-gradient(135deg,#b4a7ff 60%,#ffb6c1 100%); color:#fff; border:2px solid #ffb6c1; border-radius:18px; padding:10px 24px; font-size:1.1em; font-family:'Comic Sans MS', 'Comic Sans', sans-serif; cursor:pointer;">Clear</button>
  <div id="doodle-saved-msg" style="margin-top:12px; color:#ff69b4; font-size:1.1em;"></div>
</section>

  <footer>
    <p>© Loraine & Sofia 2025</p>
  </footer> 

<!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<!-- Firebase Realtime Database -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
  // --- Love Notes Array ---
  const loveNotes = [
    "Baby, thank you for trying again with me, its been 8 months and I'm still so happy to be back with you. ",
    "I’m so grateful for how patient you are with me, and how much you try to work things out no matter what, baby, I'll always keep trying for you",
    "You are my favorite person in the whole world, I hope I am too.",
    "December 25, Daddy robb! may pinapakta sya sakin!! mag brip ka na! ✨",
    "You're my number one sigma ⭐",
    "Thank you for letting me be your sigma!"
  ];

  const myLongLoveNote = `
    To my Dearest Sofia, <br><br>
    Happy Anniversary, our third one together. two months ago, you and I officially have been a year apart. <br>
    a month in those 3 years spent with me farther away from you than I usually already am. <br>
    That's a month I'll never get back, and a month I'll spend the rest of my life regretting giving away, and a month I'll spend the rest of my life trying to make up for. <br>
    Thank you for sticking with me for this long, for your undying patience, your love, and your understanding. <br>
    Baby, you complete me, I hope I give you the same contentment as you give me. <br>
    There are a lot of things I'm not sure of right now. For one, when I'll come home, or when I'll feel truly at home here, <br>
    or if it'll still be you I come home to when I do come back, or if we'll make it through this distance. <br>
    I keep pushing forward because I want us to work, even if I'm not sure about a lot of things. Some I won't care to mention, <br>
    Some, I'll probably never confess I worried or thought about. <br>
    I don't doubt we'll have our challenges, and many more things we won't see the same. I don't doubt either that I'll stop having thoughts like these. <br>
    I hope we get through all the challenges we'll face, I hope you and I still get to grow together even when we're miles away. <br>
    I can only pray I can be the partner you deserve, and that I can support you as you have supported me. <br>
   <br><br>
    I hope to spend the next coming years with you, and that this website was an adequate showcase of my love for you. <br>
    I hope you'll be the one to be there to understand and support me through it all. <br>
    <br><br>
    I love you more than words can say, or maybe at some point, I'll find the right words. Thank you for being my girlfriend.
  `;

  let loveCount = 0;
  let taskCompleted = false;
  let loveInputDone = false;
  let memoryDone = false;
  let quizDone = false;
  let quizSofiaDone = false;

  document.addEventListener('DOMContentLoaded', () => {
    // --- Timer ---
    const countdownElement = document.getElementById('countdown');
    let timeLeft = 30;

    const timer = setInterval(() => {
      timeLeft--;
      countdownElement.textContent = timeLeft;

      if (timeLeft === 0) {
        clearInterval(timer);
        if (!taskCompleted) {
          document.getElementById('user-input').disabled = true;
          document.getElementById('love-btn').disabled = true;
          document.getElementById('love-message').innerHTML = `
            <span style="color:#b4a7ff; font-size:1.3em;">
              Wow! You must not love me. </3 💸<br>
              <span style="font-size:2em;">😭</span>
            </span>
          `;
          // Show and play the video
          const failVideo = document.getElementById('fail-video');
          failVideo.style.display = 'block';
          failVideo.currentTime = 0;
          failVideo.play();
        }
      }
    }, 1000);

    // --- Love Input ---
    document.getElementById('love-btn').addEventListener('click', handleLoveInput);
    document.getElementById('user-input').addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        handleLoveInput();
      }
    });

    function handleLoveInput() {
      const userInput = document.getElementById('user-input').value.trim();
      if (userInput.toLowerCase() === 'i love you') {
        loveCount++;
        document.getElementById('user-input').value = '';
        if (loveCount < 3) {
          document.getElementById('love-message').innerHTML += `<span class="bouncy-heart" style="font-size:2em;">❤️</span>`;
        }
        if (loveCount === 3) {
          document.getElementById('love-message').innerHTML = 'Congratulations! You did it! <span class="bouncy-heart" style="font-size:2em;">❤️</span>';
          taskCompleted = true;
          loveInputDone = true;
          checkAllTasksDone();
        }
      } else {
        document.getElementById('love-message').innerHTML = `<span style="color:#ff69b4;">Please type exactly: I love you</span>`;
        // Show and play the video on typo
        const failVideo = document.getElementById('fail-video');
        failVideo.style.display = 'block';
        failVideo.currentTime = 0;
        failVideo.play();
        // Optionally, disable input and button
        document.getElementById('user-input').disabled = true;
        document.getElementById('love-btn').disabled = true;
      }
    }

    // --- Memory Match Game ---
    const emojis = ['💖','💖','🌸','🌸','⭐','⭐','🐻','🐻'];
    let memoryCards = [];
    let firstCard = null, secondCard = null, lockBoard = false, matchedPairs = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function createMemoryGame() {
      const game = document.getElementById('memory-game');
      if (!game) return;
      game.innerHTML = '';
      memoryCards = [];
      matchedPairs = 0;
      shuffle(emojis).forEach((emoji, idx) => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.dataset.emoji = emoji;
        card.dataset.index = idx;
        card.innerHTML = '';
        card.addEventListener('click', onCardClick);
        game.appendChild(card);
        memoryCards.push(card);
      });
      document.getElementById('memory-message').textContent = '';
      firstCard = secondCard = null;
      lockBoard = false;
    }

    function onCardClick(e) {
      const card = e.currentTarget;
      if (lockBoard || card.classList.contains('flipped') || card.classList.contains('matched')) return;
      card.classList.add('flipped');
      card.innerHTML = card.dataset.emoji;

      if (!firstCard) {
        firstCard = card;
      } else {
        secondCard = card;
        lockBoard = true;
        if (firstCard.dataset.emoji === secondCard.dataset.emoji) {
          firstCard.classList.add('matched');
          secondCard.classList.add('matched');
          matchedPairs++;
          if (matchedPairs === emojis.length / 2) {
            taskCompleted = true;
            memoryDone = true;
            showLoveNoteChoices();
            checkAllTasksDone();
          }
          resetMemoryTurn();
        } else {
          setTimeout(() => {
            firstCard.classList.remove('flipped');
            secondCard.classList.remove('flipped');
            firstCard.innerHTML = '';
            secondCard.innerHTML = '';
            resetMemoryTurn();
          }, 800);
        }
      }
    }

    function resetMemoryTurn() {
      firstCard = null;
      secondCard = null;
      lockBoard = false;
    }

    createMemoryGame();

    // --- Love Note Choices ---
    function showLoveNoteChoices() {
      const memoryMsg = document.getElementById('memory-message');
      memoryMsg.innerHTML = `<div>Yay! You matched all the pairs!<br>Choose a love note:</div>`;
      loveNotes.forEach(note => {
        const btn = document.createElement('button');
        btn.textContent = "💌";
        btn.style.margin = "8px";
        btn.onclick = () => {
          memoryMsg.innerHTML = `
            <div style="font-size:1.2em; color:#ff69b4; margin-top:16px;">${note}</div>
            <button id="pick-another" style="margin-top:16px; background:#b4a7ff; color:#fff; border-radius:12px; border:none; padding:8px 16px; font-size:1em; cursor:pointer;">Pick another note 💌</button>
          `;
          document.getElementById('pick-another').onclick = showLoveNoteChoices;
        };
        memoryMsg.appendChild(btn);
      });
    }

    // --- Quiz Game ---
    const quizQuestions = [
      {
        question: "What's my favorite color?",
        options: ["Pink", "Navy Blue", "Grey", "Beige"],
        answer: "Navy Blue"
      },
      {
        question: "Which pet do I love the most?",
        options: ["Dog", "Cat", "Bunny", "Hamster"],
        answer: "Hamster"
      },
      {
        question: "What's my favorite dessert?",
        options: ["Ice Cream", "Cake", "Donut", "Macaron"],
        answer: "Macaron"
      }
    ];
    let quizIndex = 0, quizScore = 0;

    function showQuizQuestion() {
      if (!document.getElementById('quiz-question')) return;
      if (quizIndex >= quizQuestions.length) {
        document.getElementById('quiz-question').textContent = "Quiz Complete!";
        document.getElementById('quiz-options').innerHTML = "";
        document.getElementById('quiz-result').textContent = `You got ${quizScore} out of ${quizQuestions.length} correct!`;
        taskCompleted = true;
        quizDone = true;
        checkAllTasksDone();
        return;
      }
      const q = quizQuestions[quizIndex];
      document.getElementById('quiz-question').textContent = q.question;
      document.getElementById('quiz-options').innerHTML = '';
      q.options.forEach(option => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.onclick = () => {
          if (option === q.answer) {
            quizScore++;
            document.getElementById('quiz-result').textContent = "Correct!! Meow";
          } else {
            document.getElementById('quiz-result').textContent = "Bro, why are you getting these wrong?";
          }
          quizIndex++;
          setTimeout(() => {
            document.getElementById('quiz-result').textContent = "";
            showQuizQuestion();
          }, 1000);
        };
        document.getElementById('quiz-options').appendChild(btn);
      });
    }

    // --- Quiz About Sofia ---
    const quizSofiaQuestions = [
      {
        question: "What is Sofia's current favorite hobby?",
        options: ["Reading", "Clay-Making", "Painting", "Cooking"],
        answer: "Clay-Making"
      },
      {
        question: "What is Sofia's dream travel destination?",
        options: ["Japan", "France", "Sweden", "Netherlands"],
        answer: "Netherlands"
      },
      {
        question: "Which food does Sofia dislike?",
        options: ["Adobo", "Dinuguan", "Ice Cream", "Sinigang"],
        answer: "Dinuguan"
      }
    ];
    let quizSofiaIndex = 0, quizSofiaScore = 0;

    function showQuizSofiaQuestion() {
      if (!document.getElementById('quiz-sofia-question')) return;
      if (quizSofiaIndex >= quizSofiaQuestions.length) {
        document.getElementById('quiz-sofia-question').textContent = "Quiz Complete!";
        document.getElementById('quiz-sofia-options').innerHTML = "";
        document.getElementById('quiz-sofia-result').textContent = `You got ${quizSofiaScore} out of ${quizSofiaQuestions.length} correct!`;
        quizSofiaDone = true;
        checkAllTasksDone();
        return;
      }
      const q = quizSofiaQuestions[quizSofiaIndex];
      document.getElementById('quiz-sofia-question').textContent = q.question;
      document.getElementById('quiz-sofia-options').innerHTML = '';
      q.options.forEach(option => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.onclick = () => {
          if (option === q.answer) {
            quizSofiaScore++;
            document.getElementById('quiz-sofia-result').textContent = "Correct! 🎉";
          } else {
            document.getElementById('quiz-sofia-result').textContent = "Jeez, how many girlfriends do you have? Try the next one!";
          }
          quizSofiaIndex++;
          setTimeout(() => {
            document.getElementById('quiz-sofia-result').textContent = "";
            showQuizSofiaQuestion();
          }, 1000);
        };
        document.getElementById('quiz-sofia-options').appendChild(btn);
      });
    }

    showQuizQuestion();
    showQuizSofiaQuestion();

    // --- Firebase (v8 syntax) ---
    const firebaseConfig = {
      apiKey: "AIzaSyC8COXVKQHJZUGJe19C-UO6jKen_nasEBo",
      authDomain: "sofia-de03b.firebaseapp.com",
      databaseURL: "https://sofia-de03b-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "sofia-de03b",
      storageBucket: "sofia-de03b.appspot.com",
      messagingSenderId: "1011948138101",
      appId: "1:1011948138101:web:1045bbb46c19fe4a57923c",
      measurementId: "G-ZF463CN6M6"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // --- Sofia's Message (sync with Firebase) ---
    document.getElementById('save-message-btn').onclick = function() {
      const msg = document.getElementById('sofia-message').value.trim();
      if(msg) {
        db.ref('sofiaMessage').set(msg);
        document.getElementById('sofia-message').value = '';
      }
    };

    db.ref('sofiaMessage').on('value', (snapshot) => {
      const savedMsg = snapshot.val();
      if(savedMsg) {
        document.getElementById('sofia-message-display').innerHTML =
          `<b>Sofia's message for you:</b><br><span style="background:#fffbe7; border-radius:12px; padding:12px 18px; display:inline-block; margin-top:8px;">${savedMsg.replace(/\n/g, "<br>")}</span>`;
      } else {
        document.getElementById('sofia-message-display').innerHTML = '';
      }
    });

    // --- Drawing Doodle (sync with Firebase) ---
    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let lastX = 0, lastY = 0;

    canvas.addEventListener('mousedown', (e) => {
      drawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);
    canvas.addEventListener('mousemove', draw);

    function draw(e) {
      if (!drawing) return;
      ctx.strokeStyle = '#b4a7ff';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    // Save doodle to Firebase
    document.getElementById('save-doodle-btn').onclick = function() {
      const dataURL = canvas.toDataURL();
      db.ref('sofiaDoodle').set(dataURL);
      document.getElementById('doodle-saved-msg').textContent = "Doodle saved and synced! 💖";
    };

    // Clear canvas and remove doodle from Firebase
    document.getElementById('clear-doodle-btn').onclick = function() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('doodle-saved-msg').textContent = "";
      db.ref('sofiaDoodle').remove();
    };

    // Load saved doodle from Firebase on page load and on update
    db.ref('sofiaDoodle').on('value', (snapshot) => {
      const saved = snapshot.val();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (saved) {
        const img = new window.Image();
        img.onload = function() {
          ctx.drawImage(img, 0, 0);
        };
        img.src = saved;
        document.getElementById('doodle-saved-msg').textContent = "Your saved doodle is loaded!";
      } else {
        document.getElementById('doodle-saved-msg').textContent = "";
      }
    });

  }); // end DOMContentLoaded

  function checkAllTasksDone() {
  console.log('loveInputDone:', loveInputDone, 'memoryDone:', memoryDone, 'quizDone:', quizDone, 'quizSofiaDone:', quizSofiaDone);
  if (loveInputDone && memoryDone && quizDone && quizSofiaDone) {
    document.getElementById('final-love-note-section').style.display = 'block';
    document.getElementById('final-love-note').innerHTML = myLongLoveNote;
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  }
}
</script>
</body>
</html>
